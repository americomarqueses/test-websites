<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Channel Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            padding: 40px;
            background-image: 
                linear-gradient(rgba(0,0,0,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.02) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .app-container {
            display: flex;
            gap: 40px;
            max-width: 1600px;
            margin: 0 auto;
            min-height: calc(100vh - 120px);
        }

        .header {
            background: white;
            padding: 25px 40px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
            border-radius: 8px;
            max-width: 1600px;
            margin-left: auto;
            margin-right: auto;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .logo {
            height: 40px;
            width: auto;
        }

        .header-title {
            color: #2d3748;
            font-size: 1.8em;
            font-weight: 600;
            margin: 0;
        }

        /* Left Panel - Module Library */
        .module-library {
            width: 300px;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            align-self: flex-start;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .module-library h2 {
            color: #2d3748;
            font-size: 1.2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #7dd3c0;
        }

        .module-item {
            width: 100%;
            height: 80px;
            background-color: #7dd3c0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            user-select: none;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 16px;
            color: #2d3748;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            padding: 15px;
        }

        .module-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .module-item:active {
            cursor: grabbing;
        }

        .module-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        /* Right Panel - Channels */
        .channels-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .channel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: auto;
        }

        .channel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .channel-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
            flex: 1;
            min-width: 0;
        }

        .channel-title:hover {
            background-color: #f7fafc;
        }

        .channel-title:focus {
            outline: 2px solid #4299e1;
            outline-offset: 2px;
            background-color: white;
        }

        .channel-title[contenteditable="true"] {
            cursor: text;
        }

        .add-channel-btn {
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .add-channel-btn:hover {
            background: #3182ce;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        .add-channel-btn:active {
            transform: translateY(0);
        }

        .channel-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .badge-group {
            background-color: #4299e1;
            color: white;
        }

        .badge-government {
            background-color: #48bb78;
            color: white;
        }

        .badge-normal {
            background-color: #ed8936;
            color: white;
        }

        .badge-custom {
            background-color: #9f7aea;
            color: white;
        }

        .channel-modules {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-height: 100px;
            position: relative;
        }

        .channel-module {
            width: 100%;
            height: 80px;
            background-color: #7dd3c0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            cursor: move;
            user-select: none;
            transition: transform 0.2s, box-shadow 0.2s;
            color: #2d3748;
            font-size: 16px;
            font-weight: 500;
        }

        .channel-module.module-group {
            background-color: #4299e1;
            color: white;
        }

        .channel-module.module-government {
            background-color: #48bb78;
            color: white;
        }

        .channel-module.module-normal {
            background-color: #ed8936;
            color: white;
        }

        .channel-module.module-custom {
            background-color: #9f7aea;
            color: white;
        }

        .channel-module.workflow-module {
            flex-direction: column;
            align-items: stretch;
            height: auto;
            min-height: 80px;
            padding: 20px;
            cursor: move;
        }

        .workflow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: move;
        }

        .workflow-title {
            font-weight: 500;
        }

        .workflow-description {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            background-color: white;
            color: #2d3748;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .workflow-description::placeholder {
            color: #a0aec0;
        }

        .workflow-description:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .channel-module:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .channel-module.workflow-module:hover {
            transform: none;
        }

        .channel-module.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .channel-module.drag-over {
            border: 2px dashed rgba(255, 255, 255, 0.8);
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }

        .channel-module.drag-over-top {
            border-top: 3px solid rgba(255, 255, 255, 0.8);
        }

        .channel-module.drag-over-bottom {
            border-bottom: 3px solid rgba(255, 255, 255, 0.8);
        }

        .remove-btn {
            background: #fc8181;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .remove-btn:hover {
            background: #f56565;
        }

        .drop-zone {
            min-height: 100px;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
            font-size: 14px;
            transition: all 0.2s;
        }

        .drop-zone.drag-over {
            border-color: #7dd3c0;
            background-color: #f0fdfa;
            color: #2d3748;
        }

        .empty-message {
            color: #a0aec0;
            font-style: italic;
            text-align: center;
            padding: 30px;
        }

        @media (max-width: 1024px) {
            body {
                padding: 20px;
            }

            .header {
                margin-left: 0;
                margin-right: 0;
                margin-bottom: 30px;
                border-radius: 0;
                padding: 20px;
            }

            .logo-container {
                flex-wrap: wrap;
            }

            .logo {
                height: 35px;
            }

            .header-title {
                font-size: 1.4em;
            }

            .app-container {
                flex-direction: column;
                height: auto;
                gap: 30px;
            }

            .module-library {
                width: 100%;
                max-height: 300px;
            }

            .channels-container {
                width: 100%;
                gap: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-container">
                <img src="https://i.imgur.com/tvZMJ0I.png" alt="AirAsia Logo" class="logo">
                <h1 class="header-title">Booking Channel Builder</h1>
            </div>
        </div>
    </div>
    <div class="app-container">
        <!-- Left Panel - Module Library -->
        <div class="module-library">
            <h2>Booking Engine Modules</h2>
            <div class="module-item" draggable="true" data-module="search-flight">
                Search Flight
            </div>
            <div class="module-item" draggable="true" data-module="select-flight">
                Select Flight
            </div>
            <div class="module-item" draggable="true" data-module="passengers">
                Passengers
            </div>
            <div class="module-item" draggable="true" data-module="seat-selection">
                Seat Selection
            </div>
            <div class="module-item" draggable="true" data-module="baggage">
                Baggage
            </div>
            <div class="module-item" draggable="true" data-module="ancillaries">
                Ancillaries
            </div>
            <div class="module-item" draggable="true" data-module="checkout">
                Checkout
            </div>
            <div class="module-item" draggable="true" data-module="payment">
                Payment
            </div>
            <div class="module-item" draggable="true" data-module="specific-workflow">
                Specific Workflow
            </div>
        </div>

        <!-- Right Panel - Booking Channels -->
        <div class="channels-container">
            <button class="add-channel-btn" onclick="addNewChannel()">+ Add New Channel</button>
            
            <!-- Normal Booking Channel -->
            <div class="channel" data-channel="normal">
                <div class="channel-header">
                    <div class="channel-title" contenteditable="true" onblur="handleTitleEdit(this)">Normal Booking Channel</div>
                    <span class="channel-badge badge-normal">Normal</span>
                </div>
                <div class="channel-modules" id="normal-channel">
                    <div class="empty-message">Drag modules here to build the Normal booking channel</div>
                </div>
            </div>

            <!-- Group Booking Channel -->
            <div class="channel" data-channel="group">
                <div class="channel-header">
                    <div class="channel-title" contenteditable="true" onblur="handleTitleEdit(this)">Group Booking Channel</div>
                    <span class="channel-badge badge-group">Group</span>
                </div>
                <div class="channel-modules" id="group-channel">
                    <div class="empty-message">Drag modules here to build the Group booking channel</div>
                </div>
            </div>

            <!-- Government Booking Channel -->
            <div class="channel" data-channel="government">
                <div class="channel-header">
                    <div class="channel-title" contenteditable="true" onblur="handleTitleEdit(this)">Government Booking Channel</div>
                    <span class="channel-badge badge-government">Government</span>
                </div>
                <div class="channel-modules" id="government-channel">
                    <div class="empty-message">Drag modules here to build the Government booking channel</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let draggedElement = null;
        let isFromLibrary = false;
        let draggedModuleData = null;

        // Initialize module library items
        document.querySelectorAll('.module-item').forEach(item => {
            item.addEventListener('dragstart', handleLibraryDragStart);
            item.addEventListener('dragend', handleDragEnd);
        });

        // Initialize channel modules (will be added dynamically)
        document.querySelectorAll('.channel-modules').forEach(container => {
            container.addEventListener('dragover', handleDragOver);
            container.addEventListener('drop', handleDrop);
            container.addEventListener('dragenter', handleDragEnter);
            container.addEventListener('dragleave', handleDragLeave);
        });

        function handleLibraryDragStart(e) {
            // Reset any previous state to ensure clean drag
            draggedElement = null;
            isFromLibrary = true;
            draggedModuleData = {
                module: this.getAttribute('data-module'),
                text: this.textContent.trim()
            };
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'copy';
            e.dataTransfer.setData('text/plain', draggedModuleData.module);
            // Don't set draggedElement for library items - they stay in place
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            if (e.currentTarget.classList.contains('channel-modules')) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (e.currentTarget.classList.contains('channel-modules')) {
                e.currentTarget.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();

            const channelContainer = e.currentTarget;
            channelContainer.classList.remove('drag-over');

            // Remove empty message if it exists
            const emptyMessage = channelContainer.querySelector('.empty-message');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            // Check if dragging from library
            if (isFromLibrary && draggedModuleData) {
                // Get channel type from parent channel element
                const channelElement = channelContainer.closest('.channel');
                const channelType = channelElement ? channelElement.getAttribute('data-channel') : null;
                
                // Create new module in channel (allows unlimited instances)
                const newModule = createChannelModule(draggedModuleData.module, draggedModuleData.text, channelType);
                channelContainer.appendChild(newModule);
                attachChannelModuleEvents(newModule);
                
                // Don't reset state here - let dragend handle it to avoid race conditions
            } else if (draggedElement && !isFromLibrary) {
                // Move existing module within or between channels
                const isFromDifferentContainer = draggedElement.parentElement !== channelContainer;
                
                if (isFromDifferentContainer) {
                    // Moving between channels - update color and append
                    const channelElement = channelContainer.closest('.channel');
                    const channelType = channelElement ? channelElement.getAttribute('data-channel') : null;
                    
                    // Update module color to match new channel
                    draggedElement.classList.remove('module-group', 'module-government', 'module-normal', 'module-custom');
                    if (channelType) {
                        draggedElement.classList.add(`module-${channelType}`);
                    }
                    
                    channelContainer.appendChild(draggedElement);
                }
                // If from same container, reordering is handled by module's drop handler
            }

            // Update empty message if channel becomes empty
            updateEmptyMessages();
        }

        function createChannelModule(moduleId, moduleText, channelType) {
            const moduleDiv = document.createElement('div');
            moduleDiv.className = 'channel-module';
            
            // Add channel-specific color class
            if (channelType) {
                moduleDiv.classList.add(`module-${channelType}`);
            }
            
            // Check if this is a Specific Workflow module
            if (moduleId === 'specific-workflow') {
                moduleDiv.classList.add('workflow-module');
                moduleDiv.setAttribute('draggable', 'true');
                moduleDiv.setAttribute('data-module', moduleId);
                
                // Create workflow header
                const workflowHeader = document.createElement('div');
                workflowHeader.className = 'workflow-header';
                
                const workflowTitle = document.createElement('span');
                workflowTitle.className = 'workflow-title';
                workflowTitle.textContent = moduleText;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '×';
                removeBtn.onclick = function(e) {
                    e.stopPropagation();
                    removeModule(moduleDiv);
                };
                
                workflowHeader.appendChild(workflowTitle);
                workflowHeader.appendChild(removeBtn);
                
                // Create textarea for workflow description
                const textarea = document.createElement('textarea');
                textarea.className = 'workflow-description';
                textarea.placeholder = 'Enter workflow description here...';
                textarea.setAttribute('rows', '4');
                
                // Prevent dragging when clicking on textarea
                textarea.addEventListener('mousedown', function(e) {
                    e.stopPropagation();
                });
                textarea.addEventListener('dragstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });
                textarea.setAttribute('draggable', 'false');
                
                moduleDiv.appendChild(workflowHeader);
                moduleDiv.appendChild(textarea);
            } else {
                // Regular module
                moduleDiv.setAttribute('draggable', 'true');
                moduleDiv.setAttribute('data-module', moduleId);
                
                const textSpan = document.createElement('span');
                textSpan.textContent = moduleText;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '×';
                removeBtn.onclick = function(e) {
                    e.stopPropagation();
                    removeModule(moduleDiv);
                };
                
                moduleDiv.appendChild(textSpan);
                moduleDiv.appendChild(removeBtn);
            }
            
            return moduleDiv;
        }

        function attachChannelModuleEvents(module) {
            module.addEventListener('dragstart', function(e) {
                // Prevent dragging if clicking on textarea
                if (e.target.classList.contains('workflow-description')) {
                    e.preventDefault();
                    return;
                }
                draggedElement = this;
                isFromLibrary = false;
                draggedModuleData = null; // Clear library data when dragging channel module
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            });

            module.addEventListener('dragend', function() {
                this.classList.remove('dragging');
                document.querySelectorAll('.channel-modules').forEach(container => {
                    container.classList.remove('drag-over');
                });
                // Clean up all drag-over classes from modules
                document.querySelectorAll('.channel-module').forEach(mod => {
                    mod.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
                });
                // Reset state
                if (draggedElement === this) {
                    draggedElement = null;
                }
            });

            module.addEventListener('dragenter', function(e) {
                // Only handle if dragging a channel module (not from library)
                if (!isFromLibrary && draggedElement && draggedElement !== this) {
                    e.preventDefault();
                    const rect = this.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    const mouseY = e.clientY;
                    
                    // Remove all drag-over classes
                    this.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
                    
                    // Add appropriate class based on mouse position
                    if (mouseY < midY) {
                        this.classList.add('drag-over-top');
                    } else {
                        this.classList.add('drag-over-bottom');
                    }
                }
            });

            module.addEventListener('dragleave', function(e) {
                if (!isFromLibrary && draggedElement) {
                    this.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
                }
            });

            module.addEventListener('dragover', function(e) {
                // Only prevent default if dragging a channel module (not from library)
                if (!isFromLibrary && draggedElement && draggedElement !== this) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Update visual indicator based on mouse position
                    const rect = this.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    const mouseY = e.clientY;
                    
                    this.classList.remove('drag-over-top', 'drag-over-bottom');
                    if (mouseY < midY) {
                        this.classList.add('drag-over-top');
                    } else {
                        this.classList.add('drag-over-bottom');
                    }
                }
                // If from library, let the event bubble to container
            });

            module.addEventListener('drop', function(e) {
                // Only handle if dragging a channel module (not from library)
                if (!isFromLibrary && draggedElement && draggedElement !== this) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Remove visual indicators
                    this.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
                    
                    const container = this.parentElement;
                    const allModules = Array.from(container.children).filter(c => c.classList.contains('channel-module'));
                    const dropIndex = allModules.indexOf(this);
                    const dragIndex = allModules.indexOf(draggedElement);

                    // Determine drop position based on visual indicator
                    const rect = this.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    const mouseY = e.clientY;
                    
                    if (dropIndex > dragIndex) {
                        // Dropping below, insert after this element
                        if (mouseY < midY) {
                            container.insertBefore(draggedElement, this);
                        } else {
                            container.insertBefore(draggedElement, this.nextSibling);
                        }
                    } else {
                        // Dropping above, insert before this element
                        if (mouseY < midY) {
                            container.insertBefore(draggedElement, this);
                        } else {
                            container.insertBefore(draggedElement, this.nextSibling);
                        }
                    }
                }
                // If from library, let the event bubble to container
            });
        }

        function removeModule(module) {
            const container = module.parentElement;
            module.remove();
            updateEmptyMessages();
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.channel-modules').forEach(container => {
                container.classList.remove('drag-over');
            });
            // Always reset state after drag ends
            if (isFromLibrary) {
                isFromLibrary = false;
                draggedModuleData = null;
            }
            if (draggedElement) {
                draggedElement = null;
            }
        }

        function updateEmptyMessages() {
            document.querySelectorAll('.channel-modules').forEach(container => {
                const hasModules = container.querySelectorAll('.channel-module').length > 0;
                const hasMessage = container.querySelector('.empty-message');
                
                if (!hasModules && !hasMessage) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.className = 'empty-message';
                    emptyMsg.textContent = 'Drag modules here to build the booking channel';
                    container.appendChild(emptyMsg);
                }
            });
        }

        // Add new channel
        function addNewChannel() {
            const channelsContainer = document.querySelector('.channels-container');
            const channelCount = channelsContainer.querySelectorAll('.channel').length;
            const channelId = `custom-channel-${Date.now()}`;
            
            // Create new channel element
            const newChannel = document.createElement('div');
            newChannel.className = 'channel';
            newChannel.setAttribute('data-channel', 'custom');
            
            const channelHeader = document.createElement('div');
            channelHeader.className = 'channel-header';
            
            const channelTitle = document.createElement('div');
            channelTitle.className = 'channel-title';
            channelTitle.setAttribute('contenteditable', 'true');
            channelTitle.textContent = `New Booking Channel ${channelCount + 1}`;
            channelTitle.addEventListener('blur', function() {
                handleTitleEdit(this);
            });
            
            const channelBadge = document.createElement('span');
            channelBadge.className = 'channel-badge badge-custom';
            channelBadge.textContent = 'Custom';
            
            channelHeader.appendChild(channelTitle);
            channelHeader.appendChild(channelBadge);
            
            const channelModules = document.createElement('div');
            channelModules.className = 'channel-modules';
            channelModules.id = channelId;
            
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-message';
            emptyMessage.textContent = 'Drag modules here to build the booking channel';
            
            channelModules.appendChild(emptyMessage);
            
            newChannel.appendChild(channelHeader);
            newChannel.appendChild(channelModules);
            
            // Insert before the "Add Channel" button
            const addButton = channelsContainer.querySelector('.add-channel-btn');
            channelsContainer.insertBefore(newChannel, addButton.nextSibling);
            
            // Initialize drag and drop for the new channel
            channelModules.addEventListener('dragover', handleDragOver);
            channelModules.addEventListener('drop', handleDrop);
            channelModules.addEventListener('dragenter', handleDragEnter);
            channelModules.addEventListener('dragleave', handleDragLeave);
        }

        // Handle title editing
        function handleTitleEdit(element) {
            // Trim whitespace and prevent empty titles
            const newTitle = element.textContent.trim();
            if (newTitle === '') {
                element.textContent = 'Untitled Channel';
            } else {
                element.textContent = newTitle;
            }
        }

        // Initialize editable titles for existing channels
        document.querySelectorAll('.channel-title').forEach(title => {
            title.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.blur();
                }
            });
        });
    </script>
</body>
</html>